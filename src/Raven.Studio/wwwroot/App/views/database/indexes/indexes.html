<div id="indexesContainer">
    <div class="btn-toolbar" role="toolbar" data-bind="visible: sortedGroups().length > 0">

        <div class="btn-group">
            <div class="checkbox">
                <input id="indexes_all" class="styled" type="checkbox" data-bind="checkboxTriple: indexesSelectionState, event: { change: toggleSelectAll }" title="Select all or none">
                <label for="indexes_all">&nbsp;</label>
            </div>
        </div>
        <div class="btn-group">
            <input type="text" accesskey="/" class="form-control" placeholder="Search" data-bind="value: searchText, valueUpdate: 'afterkeydown', visible: indexGroups().length > 0" title="Search for an index (Alt+/)">
            <button data-bind="enable: selectedIndexesName().length, click: copySelectedIndexes" class="btn btn-default">Copy</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="Set lock mode to selected indexes" data-bind="enable: selectedIndexesName().length">
                <i class="fa fa-lock fa-fw"></i>
                Lock mode
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
                <li data-bind="click: setLockModeSelectedIndexes.bind($root, 'Unlock', 'Unlock'), visible: lockModeCommon() !== 'Unlock'">
                    <a href="#" title="Unlock selected indexes">Unlock selected</a>
                </li>
                <li class="divider" data-bind="visible: lockModeCommon() !== 'Unlock'"></li>
                <li data-bind="click: setLockModeSelectedIndexes.bind($root, 'SideBySide', 'Lock Side By Side'), visible: lockModeCommon() !== 'SideBySide'">
                    <a href="#" title="Lock (Side By Side) selected indexes">Lock (Side By Side) selected</a>
                </li>
                <li data-bind="click: setLockModeSelectedIndexes.bind($root, 'LockedIgnore', 'Lock'), visible: lockModeCommon() !== 'LockedIgnore'">
                    <a href="#" title="Lock selected indexes">Lock selected</a>
                </li>
                <li data-bind="click: setLockModeSelectedIndexes.bind($root, 'LockedError', 'Locked Error'), visible: lockModeCommon() !== 'LockedError'">
                    <a href="#" title="Lock (Error) selected indexes">Lock (Error) selected</a>
                </li>
            </ul>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-danger" data-bind="click: deleteSelectedIndexes">
                <i class="fa fa-trash-o"></i> Delete
            </button>
        </div>
        
        <div class="btn-group">
            <button type="button" class="btn btn-default" data-bind="click: stopIndexing, visible: indexingEnabled()">
                Disable indexing until restart
            </button>
            <button type="button" class="btn btn-default" data-bind="click: startIndexing, visible: !indexingEnabled()">
                Resume indexing
            </button>
        </div>

    </div>

    <div class="text-center" data-bind="visible: sortedGroups().length == 0">
        <h3 class="page-header text-info">
            <div>No indexes have been created for this database.</div>
            <div>
                <small>
                    Go ahead and <a href="#" data-bind="attr: { href: newIndexUrl }">create an index</a>
                    , <a href="#" data-bind="click: pasteIndex">paste single index</a> or <a href="#" data-bind="click: pasteIndexesAndTransformers">paste a bulk</a> of indexes and transformers definitions from JSON.
                </small>
            </div>
        </h3>
    </div>

    <div data-bind="dynamicHeight: { resizeTrigger: window.ravenStudioWindowHeight(), target: 'footer' }" style="overflow: auto">
        <div class="indexes-container panel-group index-panel" id="indexesAccordion" data-bind="foreach: sortedGroups">
            <div class="index-group panel panel-default index-panel" data-bind="visible: !groupHidden()">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-bind="attr: { href: '#indexCollapse' + $index() }">
                            <span data-bind="text: entityName"></span>
                        </a>
                    </h4>
                </div>
                <div class="index-group-content panel-collapse in index-panel" data-bind="attr: { id: 'indexCollapse' + $index() }">
                    <div class="panel-body index-panel" data-bind="foreach: indexes" style="overflow: visible;">
                        <div class="index-panel panel panel-default" data-bind="visible: !filteredOut()">
                            <div class="panel-body">
                                <h4 class="pull-left">

                                    Badge: <span data-bind="text: getIndexBadgeName()"></span>

                                    <input type="checkbox" data-bind="checked: $root.selectedIndexesName, checkedValue: name" />

                                    <span data-bind="text: name"></span>
                                    
                                    <span data-bind="visible: isStale()">Stale</span>

                                    <span data-bind="text: type"></span>
                                    <span data-bind="text: entriesCount"></span> entires
                                </h4>

                                <div class="pull-left">
                                    <div data-bind="template: { name: 'priority-template' }"></div>
                                    <div data-bind="template: { name: 'lock-mode-template' }"></div>
                                </div>

                                <div class="pull-right">
                                    <a class="btn btn-default" title="Query this index" data-bind="attr: { href: queryUrl() }">
                                        Query
                                    </a>
                                    <button class="btn btn-default" data-bind="click: $root.copyIndex.bind($root, $data)" title="Copy index">
                                        <i class="fa fa-copy fa-fw"></i>
                                    </button>

                                    <a class="btn btn-default indexes-controls" data-placement="bottom" data-bind="attr: { href: editUrl() }">
                                        <i class="fa fa-pencil"></i>
                                    </a>

                                    <button class="btn btn-default" data-bind="click: $root.resetIndex.bind($root, $data)" title="Reset the index">
                                        <i class="fa fa-undo fa-fw"></i>
                                    </button>

                                    <button class="btn btn-danger" title="Delete the index" data-bind="click: $root.deleteIndex.bind($root)">
                                        <i class="fa fa-trash-o fa-fw text-danger"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<script type="text/html" id="priority-template">
    Priority:


    <div class="dropdown">
        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
            <span data-bind="visible: pausedUntilRestart()">
                <i class="fa fa-ban fa-fw"></i>
                Disabled until restart
            </span>
            <span data-bind="visible: !pausedUntilRestart() && isNormalPriority()">
                <i class="fa fa-check fa-fw"></i>
                Normal
            </span>
            <span data-bind="visible: !pausedUntilRestart() && isIdle()">
                <i class="fa fa-arrow-down fa-fw"></i>
                Idle
            </span>
            <span data-bind="visible: !pausedUntilRestart() && isDisabled()">
                <i class="fa fa-ban fa-fw"></i>
                Disabled
            </span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li role="presentation">
                <a href="#" data-bind="click: $root.normalPriority.bind($root, $data), css: { active: priority() === 'Normal' }" title="Normal">
                    <i class="fa fa-check fa-fw"></i>
                    Normal
                </a>
            </li>
            <li role="presentation">
                <a href="#" data-bind="click: $root.idlePriority.bind($root, $data), css: { active: isIdle() }" title="Idle">
                    <i class="fa fa-arrow-down fa-fw"></i>
                    Idle
                </a>
            </li>
            <li role="presentation">
                <a href="#" data-bind="click: $root.disabledPriority.bind($root, $data), css: { active: isDisabled() }" title="Disabled">
                    <i class="fa fa-ban fa-fw"></i>
                    Disabled
                </a>
            </li>
            <li role="presentation" data-bind="visible: canBePaused()">
                <a href="#" data-bind="click: $root.disableUntilRestart.bind($root, $data)" title="Disable until server restart">
                    <i class="fa fa-ban fa-fw"></i>
                    Disable until restart
                </a>
            </li>
            
            <li role="presentation" data-bind="visible: canBeResumed()">
                <a href="#" data-bind="click: $root.resumeIndexing.bind($root, $data)" title="Resume indexing">
                    <i class="fa fa-check fa-fw"></i>
                    Resume indexing
                </a>
            </li>
        </ul>
    </div>

</script>

<script type="text/html" id="lock-mode-template">
    Status:

    <div class="dropdown">
        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
            <span data-bind="visible: lockMode() === 'Unlock'">
                <i class="fa fa-unlock fa-fw"></i>
                Unlocked
            </span>
            <span data-bind="visible: lockMode() === 'SideBySide'">
                <i class="fa fa-lock fa-fw"></i>
                Locked (side-by-side)
            </span>
            <span data-bind="visible: lockMode() === 'LockedIgnore'">
                <i class="fa fa-lock fa-fw"></i>
                Locked
            </span>
            <span data-bind="visible: lockMode() === 'LockedError'">
                <i class="fa fa-lock text-danger fa-fw"></i>
                Locked (Error)
            </span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li role="presentation">
                <a href="#" data-bind="click: $root.unlockIndex.bind($root, $data), css: { active: lockMode() === 'Unlock' }" title="Unlocked: The index is unlocked for changes; apps can modify it, e.g. via IndexCreation.CreateIndexes().">
                    <i class="fa fa-unlock fa-fw"></i>
                    Unlocked
                </a>
            </li>
            <li role="presentation">
                <a href="#" data-bind="click: $root.lockSideBySide.bind($root, $data), css: { active: lockMode() === 'SideBySide' }" title="Side-by-side: The index is locked for changes; apps cannot modify it. Programmatic attempts to modify the index will be ignored. Index be can only updated via side-by-side index.">
                    <i class="fa fa-lock fa-fw"></i>
                    Locked (side-by-side)
                </a>
            </li>
            <li role="presentation">
                <a href="#" data-bind="click: $root.lockIndex.bind($root, $data), css: { active: lockMode() === 'LockedIgnore' }" title="Locked: The index is locked for changes; apps cannot modify it. Programmatic attempts to modify the index will be ignored.">
                    <i class="fa fa-lock fa-fw"></i>
                    Locked
                </a>
            </li>
            <li role="presentation">
                <a href="#" data-bind="click: $root.lockErrorIndex.bind($root, $data), css: { active: lockMode() === 'LockedError' }" title="Locked + Error: The index is locked for changes; apps cannot modify it. An error will be thrown if an app attempts to modify it.">
                    <i class="fa fa-lock text-danger fa-fw"></i>
                    Locked (Error)
                </a>
            </li>
        </ul>
    </div>
</script>