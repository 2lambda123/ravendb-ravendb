<div class="indexes content-margin no-transition" data-bind="css: { 'no-transition': indexesCount() > 50 }">
    
    <div class="flex-vertical absolute-fill" data-bind="visible: sortedGroups().length">
        
        <div class="flex-grow scroll js-scroll-container">
            <div data-bind="foreach: sortedGroups">
                <h2 class="on-base-background" data-bind="text: entityName, visible: !groupHidden(), attr: { title: 'Collection: ' + entityName }"></h2>
                <div data-bind="foreach: indexes, visible: !groupHidden()">
                    <div data-bind="css: { 'sidebyside-indexes': replacement }, visible: !filteredOut()">
                        <div class="panel panel-state panel-hover index" data-bind="template: { name: 'index-template' }, css: { 'has-replacement': replacement }">
                        </div>
                        <div class="sidebyside-actions" data-bind="with: replacement, visible: replacement">
                            <div class="panel panel-state panel-warning">
                                <div class="state state-swap"> <i class="icon-swap"></i> </div>
                                <div class="padding flex-horizontal">
                                    <div class="title">Side by side</div>
                                    <div class="flex-separator"></div>
                                    <button class="btn btn-sm btn-warning" title="Click to replace the current index definition with the replacement index"
                                            data-bind="click: _.partial($root.swapSideBySide, $data.parent), css: { 'btn-spinner': _.includes($root.spinners.swapNow(), parent.name) },
                                                       disable: _.includes($root.spinners.swapNow(), parent.name)">
                                        <i class="icon-force"></i> <span>Swap now</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div data-bind="with: replacement">
                            <div class="panel panel-state panel-hover index" data-bind="template: { name: 'index-template' }">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="indexes-progress-template">
    <div class="progress-container">
        <div class="progress-overall">
            <div class="flex-horizontal" data-bind="with: globalProgress">
                <div class="flex-grow"><span data-bind="text: formattedTimeLeftToProcess"></span></div>
                <div class="percentage" data-bind="text: percentageFormatted,  css: { 'text-success': completed }, attr: { title: textualProgress }"></div>
            </div>
            <div class="progress" data-bind="with: globalProgress">
                <div data-bind="css: { 'progress-bar-striped': !completed && !isDisabled, 'progress-bar-primary': !completed, 'active': !completed && !isDisabled, 'progress-bar-success': completed }, style: { width: percentageFormatted }, attr: { 'aria-valuenow': percentage, title: textualProgress } "
                     class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                    <span class="sr-only" data-bind="text: percentageFormatted() + ' Completed'"></span>
                </div>
            </div>
        </div>
        <div class="collections-container">
            <!-- ko foreach: collections -->
            <div class="panel collection-progress">
                <div class="collection-name" data-bind="text: name, attr: { title: name }"></div>
                <div class="documents">
                    <div class="clearfix" data-bind="with: documentsProgress">
                        <small class="name">Documents</small>
                        <small class="percentage" data-bind="text: percentageFormatted(), css: { 'text-success': completed }, attr: { title: textualProgress}"></small>
                    </div>
                    <div class="progress" data-bind="with: documentsProgress">
                        <div data-bind="css: { 'progress-bar-striped': !completed && !isDisabled, 'progress-bar-primary': !completed, 'active': !completed && !isDisabled, 'progress-bar-success': completed }, style: { width: percentageFormatted }, attr: { 'aria-valuenow': percentage, title: textualProgress } "
                             class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                            <span class="sr-only" data-bind="text: percentageFormatted() + ' Completed'"></span>
                        </div>
                    </div>
                </div>
                <div class="tombstones">
                    <div class="clearfix" data-bind="with: tombstonesProgress">
                        <small class="name">Tombstones</small>
                        <small class="percentage" data-bind="text: percentageFormatted(), css: { 'text-success': completed }, attr: { title: textualProgress }"></small>
                    </div>
                    <div class="progress" data-bind="with: tombstonesProgress">
                        <div data-bind="css: { 'progress-bar-striped': !completed && !isDisabled, 'progress-bar-primary': !completed, 'active': !completed && !isDisabled, 'progress-bar-success': completed }, style: { width: percentageFormatted }, attr: { 'aria-valuenow': percentage, title: textualProgress } "
                             class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                            <span class="sr-only" data-bind="text: percentageFormatted() + ' Completed'"></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->
        </div>
    </div>
</script>


