<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:iis="http://schemas.microsoft.com/wix/IIsExtension"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
  <Product Id="*" Name="RavenDB" Language="1033" Version="2.5.0.0" Manufacturer="Hibernating Rhinos LTD" UpgradeCode="79a41e9e-dc99-4df8-9820-1de16e63c655">
    <Package InstallerVersion="200" Compressed="yes" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <Media Id='1' Cabinet='Sample.cab' EmbedCab='yes' />

    <Property Id="RAVEN_INSTALLATION_TYPE" Value="IIS" /> <!-- default value -->
    
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />
    
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id='HibernatingRhinos' Name='HibernatingRhinos'>
          <Directory Id="INSTALLFOLDER" Name="RavenDB">
            <Directory Id="MYWEBWEBSITE" Name="Website">

            </Directory>
          </Directory>
        </Directory>
      </Directory>

      <!--<Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="RavenDB">
          <Component Id="ProgramMenuDir" Guid="ECB41950-1566-4EE1-93E9-5B8E23B77D80">
            <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
            <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
          </Component>
        </Directory>
      </Directory>-->

      <!--<Directory Id="DesktopFolder" Name="Desktop" />-->

    </Directory>

    <Feature Id='Service' 
             Title='RavenDB Windows Service' 
             Description='RavenDB service'
             Display='expand' 
             Level='1' 
             ConfigurableDirectory='INSTALLFOLDER'>
      <ComponentRef Id='Raven.Server' />
      <ComponentRef Id='Raven.Database' />
      <ComponentRef Id='Raven.Abstractions' />
      <Condition Level='0'><![CDATA[RAVEN_INSTALLATION_TYPE = "SERVICE"]]></Condition>
    </Feature>

    <Feature Id='IIS'
             Title='RavenDB hosted in IIS'
             Description='RavenDB service'
             Display='expand'
             Level='1'
             ConfigurableDirectory='INSTALLFOLDER'>
      <Condition Level='0'><![CDATA[RAVEN_INSTALLATION_TYPE = "IIS"]]></Condition>
      <ComponentRef Id='Raven.Web' />
      <ComponentRef Id='Raven.Database' />
      <ComponentRef Id='Raven.Abstractions' />
      
      <!-- Include IIS Configuration. -->
      <ComponentGroupRef Id="MyWebIssConfiguration" />

      <!-- Perform changes in the web.config file. -->
      <ComponentRef Id="WebConfigCmp" />
    </Feature>

    <DirectoryRef Id="MYWEBWEBSITE">
      <!-- Component handling the web.config -->
      <Component Id="WebConfigCmp" Guid="">
        <!-- Copy web.config to MYWEBWEBSITE folder. -->
        <File Id="WebConfigFile" KeyPath="yes"
          Source="$(var.SolutionDir)\DefaultConfigs\Web.config" Vital="yes" />
        <!--<util:XmlFile Id="ModifyConnectionString"
                 Action="setValue"
                 Permanent="yes"
                 ElementPath="/configuration/connectionStrings/
                                      add[\[]@name='MyConnectionString'[\]]"
                 Name="connectionString"
                 File="[#WebConfigFile]"
                 Value="[CONNECTION_STRING]"
                 SelectionLanguage="XSLPattern"
                 Sequence="1" />-->
      </Component>
    </DirectoryRef>

    <UIRef Id="InstallerUI" />

    <!--<Property Id="PIDTemplate"><![CDATA[12345<### ###>@@@@@]]></Property>-->

    <!--<Icon Id="Raven.ico" SourceFile="$(var.Raven.Server.ProjectDir)\favicon.ico" />-->

  </Product>
</Wix>