<style>
    .batchRange rect {
        opacity: 0.4;
    }
    .batchRange rect:hover {
        opacity: 0.6;
    }
    .rect_legend {
        width: 15px;
        height: 15px;
        border: solid 1px black;
    }
    .op {
        cursor: pointer;
    }
    #metricsIndexingGraph text {
         pointer-events: none;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    .op rect {
        opacity: 1;
    }
    .op:hover rect {
        opacity: 0.8;
    }
    .batchRange {
        cursor: pointer;
    }
    .selectable-tooltip .close {
        pointer-events: all;
        -webkit-touch-callout: all;
        -webkit-user-select: all;
        -khtml-user-select: all;
        -moz-user-select: all;
        -ms-user-select: all;
        user-select: all;
    }
    line.reduce_split_line {
        stroke:black;
        stroke-width: 1;
        opacity: 0.5;

    }

</style>

<script type="text/html" id="map-batch-info-template">
    <div style="padding: 10px">
        <form>
            <button type="button" class="close" data-bind="click: tooltipClose"><i class="fa fa-times"></i></button>
        </form>
        <table class="table table-condensed table-striped" data-bind="with: data">
            <thead>
                <tr>
                    <th>Batch type</th>
                    <th data-bind="text: BatchType"></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Indexes to work on</td>
                    <td>
                        <ul data-bind="foreach: IndexesToWorkOn">
                            <li data-bind="text: $data"></l>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Total document count</td>
                    <td data-bind="text: TotalDocumentCount"></td>
                </tr>
                <tr>
                    <td>Total document size</td>
                    <td data-bind="text: TotalDocumentSize"></td>
                </tr>
                <tr>
                    <td>Started at</td>
                    <td data-bind="text: StartedAt"></td>
                </tr>
                <tr>
                    <td>Total duration</td>
                    <td data-bind="text: TotalDurationMs"></td>
                </tr>
            </tbody>
        </table>
    </div>
</script>


<script type="text/html" id="reduce-batch-info-template">
    <div style="padding: 10px">
        <form>
            <button type="button" class="close" data-bind="click: tooltipClose"><i class="fa fa-times"></i></button>
        </form>
        <table class="table table-condensed table-striped" data-bind="with: data">
            <tbody>
                <tr>
                    <td>Indexes to work on</td>
                    <td>
                        <ul data-bind="foreach: IndexesToWorkOn">
                            <li data-bind="text: $data"></l>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td>Started at</td>
                    <td data-bind="text: StartedAt"></td>
                </tr>
                <tr>
                    <td>Total duration</td>
                    <td data-bind="text: TotalDurationMs"></td>
                </tr>
                <tr>
                    <td>Time since first reduce<br />in batch completed ms</td>
                    <td data-bind="text: TimeSinceFirstReduceInBatchCompletedMs"></td>
                </tr>
            </tbody>
        </table>
    </div>
</script>

<script type="text/html" id="index-stat-template">
    <div style="padding: 10px">
        <form>
            <button type="button" class="close" data-bind="click: tooltipClose"><i class="fa fa-times"></i></button>
        </form>

        <table class="table table-condensed table-striped" data-bind="with: data">
            <thead>
                <tr>
                    <th>Index stats:</th>
                    <th data-bind="text: indexName"></th>
                </tr>
            </thead>
            <tbody data-bind="with: stats">
                <tr>
                    <td>Operation</td>
                    <td data-bind="text: Operation"></td>
                </tr>
                <tr>
                    <td>Input count</td>
                    <td data-bind="text: InputCount"></td>
                </tr>
                <tr>
                    <td>Items count</td>
                    <td data-bind="text: ItemsCount"></td>
                </tr>
                <tr>
                    <td>Output count</td>
                    <td data-bind="text: OutputCount"></td>
                </tr>
                <tr>
                    <td>Duration</td>
                    <td data-bind="text: Duration"></td>
                </tr>
                <tr>
                    <td>Started</td>
                    <td data-bind="text: Started"></td>
                </tr>

                <tr data-bind="visible: LoadDocumentPerformance.LoadDocumentDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[0] }" class="rect_legend"></span> LoadDocument [ms]</td>
                    <td data-bind="text: LoadDocumentPerformance.LoadDocumentDurationMs"></td>
                </tr>
                <tr data-bind="visible: LinqExecutionPerformance.MapLinqExecutionDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[1] }" class="rect_legend"></span> Linq: map execution [ms]</td>
                    <td data-bind="text: LinqExecutionPerformance.MapLinqExecutionDurationMs"></td>
                </tr>
                <tr data-bind="visible: LinqExecutionPerformance.ReduceLinqExecutionDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[2] }" class="rect_legend"></span> Linq: reduce execution [ms]</td>
                    <td data-bind="text: LinqExecutionPerformance.ReduceLinqExecutionDurationMs"></td>
                </tr>
                <tr data-bind="visible:  LucenePerformance.DeleteExistingDocumentsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[3] }" class="rect_legend"></span> Lucene: delete existing documents [ms]</td>
                    <td data-bind="text: LucenePerformance.DeleteExistingDocumentsDurationMs,"></td>
                </tr>
                <tr data-bind="visible:  LucenePerformance.ConvertToLuceneDocumentsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[4] }" class="rect_legend"></span> Lucene: Convert to lucene documents [ms]</td>
                    <td data-bind="text: LucenePerformance.ConvertToLuceneDocumentsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  LucenePerformance.AddDocumentsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[5] }" class="rect_legend"></span> Lucene: Add documents [ms]</td>
                    <td data-bind="text: LucenePerformance.AddDocumentsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  LucenePerformance.FlushToDiskDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[6] }" class="rect_legend"></span> Lucene: Flush to disk [ms]</td>
                    <td data-bind="text: LucenePerformance.FlushToDiskDurationMs"></td>
                </tr>
                <tr data-bind="visible:  LucenePerformance.RecreateSearcherDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[7] }" class="rect_legend"></span> Lucene: recreate searcher [ms]</td>
                    <td data-bind="text: LucenePerformance.RecreateSearcherDurationMs"></td>
                </tr>
                <tr data-bind="visible:  MapStoragePerformance.DeleteMappedResultsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[8] }" class="rect_legend"></span> Map: delete mapped results [ms]</td>
                    <td data-bind="text: MapStoragePerformance.DeleteMappedResultsDurationMs"></td>
                </tr>
                <tr data-bind="visible: MapStoragePerformance.PutMappedResultsDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[9] }" class="rect_legend"></span> Map: put mapped results [ms]</td>
                    <td data-bind="text: MapStoragePerformance.PutMappedResultsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  MapStoragePerformance.ScheduleReductionsDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[10] }" class="rect_legend"></span> Map: schedule reducations [ms]</td>
                    <td data-bind="text: MapStoragePerformance.ScheduleReductionsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  MapStoragePerformance.StorageCommitDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[11] }" class="rect_legend"></span> Map: storage commit [ms]</td>
                    <td data-bind="text: MapStoragePerformance.StorageCommitDurationMs"></td>
                </tr>
                <tr>
                    <td>Waiting time since<br /> last batch completed</td>
                    <td data-bind="text: WaitingTimeSinceLastBatchCompleted"></td>
                </tr>
            </tbody>
        </table>
    </div>
</script>

<script type="text/html" id="reduce-stat-template">
    <div style="padding: 10px">
        <form>
            <button type="button" class="close" data-bind="click: tooltipClose"><i class="fa fa-times"></i></button>
        </form>

        <table class="table table-condensed table-striped" data-bind="with: data">
            <thead>
                <tr>
                    <th>Reduce of index stats:</th>
                    <th data-bind="text: parent.indexName"></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Reduce type</td>
                    <td data-bind="text: parent.stats.ReduceType"></td>
                </tr>
                <tr>
                    <td>Level</td>
                    <td data-bind="text: Level"></td>
                </tr>
                <tr>
                    <td>Items count</td>
                    <td data-bind="text: ItemsCount"></td>
                </tr>
                <tr>
                    <td>Output count</td>
                    <td data-bind="text: OutputCount"></td>
                </tr>
                <tr>
                    <td>Duration</td>
                    <td data-bind="text: Duration"></td>
                </tr>
                <tr>
                    <td>Started</td>
                    <td data-bind="text: Started"></td>
                </tr>

                <tr data-bind="visible: LinqExecutionPerformance.MapLinqExecutionDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[0] }" class="rect_legend"></span> Linq: map execution [ms]</td>
                    <td data-bind="text: LinqExecutionPerformance.MapLinqExecutionDurationMs"></td>
                </tr>
                <tr data-bind="visible: LinqExecutionPerformance.ReduceLinqExecutionDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[1] }" class="rect_legend"></span> Linq: reduce execution [ms]</td>
                    <td data-bind="text: LinqExecutionPerformance.ReduceLinqExecutionDurationMs"></td>
                </tr>
                <tr data-bind="visible: LucenePerformance.DeleteExistingDocumentsDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[2] }" class="rect_legend"></span> Lucene: delete existing documents [ms]</td>
                    <td data-bind="text: LucenePerformance.DeleteExistingDocumentsDurationMs,"></td>
                </tr>
                <tr data-bind="visible: LucenePerformance.ConvertToLuceneDocumentsDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[3] }" class="rect_legend"></span> Lucene: Convert to lucene documents [ms]</td>
                    <td data-bind="text: LucenePerformance.ConvertToLuceneDocumentsDurationMs"></td>
                </tr>
                <tr data-bind="visible: LucenePerformance.AddDocumentsDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[4] }" class="rect_legend"></span> Lucene: Add documents [ms]</td>
                    <td data-bind="text: LucenePerformance.AddDocumentsDurationMs"></td>
                </tr>
                <tr data-bind="visible: LucenePerformance.FlushToDiskDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[5] }" class="rect_legend"></span> Lucene: Flush to disk [ms]</td>
                    <td data-bind="text: LucenePerformance.FlushToDiskDurationMs"></td>
                </tr>
                <tr data-bind="visible: LucenePerformance.RecreateSearcherDurationMs >= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[6] }" class="rect_legend"></span> Lucene: recreate searcher [ms]</td>
                    <td data-bind="text: LucenePerformance.RecreateSearcherDurationMs"></td>
                </tr>
                <tr data-bind="visible:  ReduceStoragePerformance.GetItemsToReduceDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[7] }" class="rect_legend"></span> Reduce: get items to reduce [ms]</td>
                    <td data-bind="text: ReduceStoragePerformance.GetItemsToReduceDurationMs"></td>
                </tr>
                <tr data-bind="visible:  ReduceStoragePerformance.DeletePreviouslyScheduledReductionsMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[8] }" class="rect_legend"></span> Reduce: delete previously scheduled reducations [ms]</td>
                    <td data-bind="text: ReduceStoragePerformance.DeletePreviouslyScheduledReductionsMs"></td>
                </tr>
                <tr data-bind="visible:  ReduceStoragePerformance.ScheduleReductionsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[9] }" class="rect_legend"></span> Reduce: schedule reductions [ms]</td>
                    <td data-bind="text: ReduceStoragePerformance.ScheduleReductionsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  ReduceStoragePerformance.GetMappedResultsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[10] }" class="rect_legend"></span> Reduce: get mapped results [ms]</td>
                    <td data-bind="text: ReduceStoragePerformance.GetMappedResultsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  ReduceStoragePerformance.RemoveReduceResultsDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[11] }" class="rect_legend"></span> Reduce: remove reduce results [ms]</td>
                    <td data-bind="text: ReduceStoragePerformance.RemoveReduceResultsDurationMs"></td>
                </tr>
                <tr data-bind="visible:  ReduceStoragePerformance.StorageCommitDurationMs>= 0">
                    <td><span data-bind=" style: { 'backgroundColor': $root.colors[12] }" class="rect_legend"></span> Reduce: storage commit [ms]</td>
                    <td data-bind="text: ReduceStoragePerformance.StorageCommitDurationMs"></td>
                </tr>
            </tbody>
        </table>
    </div>
</script>

<div>
    <div class="btn-group">
        <button class="btn btn-default" data-bind="event: { mousedown: startZoomIn, mouseup: stopZoomIn }" title="Zoom in"><i class="fa fa-search-plus"></i></button>
        <button class="btn btn-default" data-bind="event: { mousedown: startZoomOut, mouseup: stopZoomOut }" title="Zoom out"><i class="fa fa-search-minus"></i></button>    
    </div>
    <div class="btn-group">
        <select id="visibleIndexesSelector" data-bind="options: allIndexNames, selectedOptions: selectedIndexNames" multiple="multiple"></select>
    </div>
    
    
</div>

<section id="metricsContainer" style="width: 100%" data-bind="dynamicHeight: { resizeTrigger: window.ravenStudioWindowHeight(), target: 'footer' }">
    <svg id="indexPerformanceGraph" transform="translate(0.5,0.5)" preserveAspectRatio="xMinYMin slice"></svg>
</section>